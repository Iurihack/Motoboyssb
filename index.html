<script>
const checklistItems = [ /* ... os itens */ ];
let currentUser = '';
let currentPassword = '';

function login() {
  const user = document.getElementById('username').value;
  const pass = document.getElementById('password').value;

  if (!user || !pass) {
    alert("Preencha usuário e senha");
    return;
  }

  currentUser = user;
  currentPassword = pass;

  document.getElementById('login').classList.add('hidden');
  document.getElementById('formulario').classList.remove('hidden');
  buildChecklist();
}

function buildChecklist() {
  const container = document.getElementById('checklistItems');
  container.innerHTML = '';
  checklistItems.forEach(item => {
    const div = document.createElement('div');
    div.innerHTML = `
      <label>${item}:</label>
      <select name="${item}">
        <option value="Sim">Sim</option>
        <option value="Não">Não</option>
      </select>
    `;
    container.appendChild(div);
  });

  document.getElementById('checklistForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const moto = document.getElementById('motoSelect').value;
    const data = document.getElementById('data').value;
    const hora = document.getElementById('hora').value;

    if (!data || !hora) {
      alert("Preencha data e hora");
      return;
    }

    const checklist = checklistItems.map(item => {
      const val = document.querySelector(`select[name="${item}"]`).value;
      return `${item}: ${val}`;
    });

    const body = {
      usuario: currentUser,
      senha: currentPassword,
      moto,
      data,
      hora,
      checklist
    };

    try {
      const res = await fetch('/checklist', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });

      const result = await res.json();
      alert(result.message);
    } catch (err) {
      alert('Erro ao enviar checklist.');
    }
  });
}
</script>
